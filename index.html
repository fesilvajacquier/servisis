<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Service Objects en Rails</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/white.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
    <div class="reveal">
      <div class="slides">
        <!-- Introducci贸n -->
        <section>
          <section>
            <h1>Service Objects en Rails</h1>
            <h3>Un peque帽o ensayo a favor de los service objects</h3>
            <aside class="notes">
              When I first discovered the concept of service objects, I found a lot of strong opinions around themmost of them against their use. I didn't really get all the criticism, but I also didn't feel fully comfortable using them myself. Something always felt a bit 'off'. And yet, over time, I realized that the problem wasn't with the pattern itselfit was with how it was being used. Once I shaped them in a way that made sense for my app, my team, my logic, everything clicked into place.
            </aside>
          </section>
          <section>
            <!-- foto -->
            <p>Fernando E. Silva Jacquier<div><small>fesilvajacquier</small></div></p>

            <small>
              <div>Tech Lead en <a href="https://www.boxful.io" target="_blank" rel="noopener">Boxful</a></div>
              <div>Consultor</div>
              <div>Teacher en <a href="https://www.lewagon.com/" target="_blank" rel="noopener">Le Wagon</a></div>
            </small>
          </section>
        </section>

        <!-- Cr铆ticas a los Service Objects -->
        <section>
          <section>
            <h2>Empecemos por las cr铆ticas</h2>
          </section>
          <section>
            <blockquote>
             > The wrong object causes more trouble than no object at all
            </blockquote>
            <blockquote>
             > Service Objects accumulate invisible inter-service coupling
            </blockquote>
            <p>
             <a href="https://avdi.codes/service-objects/" target="_blank" rel="noopener">Service Objects</a> by Avdi Grimm
            </p>
          </section>
          <section>
            <blockquote class="twitter-tweet"><p lang="en" dir="ltr">Using services is, in essence, ignoring OOP and having your code in imperative mode. This serie by <a href="https://twitter.com/jorgemanru?ref_src=twsrc%5Etfw">@jorgemanru</a> changed my way of looking at fat models. They&#39;re good! Let the domain model do the job instead of exposing implementation details. <a href="https://t.co/p1AgfK0jx6">https://t.co/p1AgfK0jx6</a></p>&mdash; Bruno Prieto (@brunoprietog) <a href="https://twitter.com/brunoprietog/status/1882503197530734601?ref_src=twsrc%5Etfw">January 23, 2025</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </section>
          <section>
            <blockquote class="twitter-tweet"><p lang="en" dir="ltr">So, everybody who refactored their entire codebase&#39;s jobs and controllers into 1-liners that say <a href="https://t.co/XUAJzN1xW3">https://t.co/XUAJzN1xW3</a> now all have perfect, clean code, right? Living in heavenly bliss, yeah?</p>&mdash; Nate Berkopec (@nateberkopec) <a href="https://twitter.com/nateberkopec/status/1675675501438828545?ref_src=twsrc%5Etfw">July 3, 2023</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </section>
          <section>
            <blockquote class="twitter-tweet"><p lang="en" dir="ltr">We could have avoided 99% of this service object nonsense if we had just made Rails controllers easier to test</p>&mdash; Nate Berkopec (@nateberkopec) <a href="https://twitter.com/nateberkopec/status/1698580957891326120?ref_src=twsrc%5Etfw">September 4, 2023</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </section>
          <section>
            <blockquote class="twitter-tweet"><p lang="en" dir="ltr">Started at 1, leveled up to 4 <a href="https://t.co/KywL9sKL4P">pic.twitter.com/KywL9sKL4P</a></p>&mdash; Jose Farias (@readjosefarias) <a href="https://twitter.com/readjosefarias/status/1856736691186508043?ref_src=twsrc%5Etfw">November 13, 2024</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </section>
          <section>
            <img src="images/defreyne.jpg" alt="" class="r-stretch">
          </section>
          <section>
            <img src="images/morrice.jpg" alt="" class="r-stretch">
          </section>
          <section>
            <blockquote>
              > What does this mean? It means the service object pattern has no intrinsic ability to make your codebase easier to read, easier to maintain, simpler, or exhibit better separation of concerns.
            </blockquote>
            <p>
              <a href="https://www.fullstackruby.dev/object-orientation/rails/2018/03/06/why-service-objects-are-an-anti-pattern/" target="_blank" rel="noopener">Why Service Objects are an Anti-Pattern</a> by Jared White
            </p>
          </section>
        </section>
        <!-- Entonces, 驴Por qu茅 son tan populares los service objects? -->
        <section>
          <section>
            <h3>Entonces, 驴Por qu茅 son tan populares los service objects?</h3>
          </section>
          <section>
            <p>La doctrina de de Rails dice: <a href="https://rubyonrails.org/doctrine#no-one-paradigm">No one paradigm</a></p>
            <small>
              <blockquote>
                > Rails isn't like that. It isn't a single, perfect cut of cloth. It's a quilt. A composite of many different ideas and even paradigms. Many that would usually be seen in conflict, if contrasted alone and one by one. But that's not what we're trying to do. It isn't a single championship of superior ideas where a sole winner must be declared.
              </blockquote>
            </small>
          </section>
          <section>
            <h3>Peeeeeeeero...</h3>
          </section>
          <section>
            <div style="display: flex;">
              <div style="width: 30%;">
                <img src="images/eaa.jpg" alt="Patterns of Enterprise Application Architecture">
              </div>
              <div style="width: 70%;">
                <small>
                  <p>En <a href="https://guides.rubyonrails.org/active_record_basics.html#the-active-record-pattern" target="_blank" rel="noopener">Rails Guides - Active Record Basics</a> se hace menci贸n directa a <a href="https://martinfowler.com/books/eaa.html" target="_blank" rel="noopener">Patterns of Enterprise Application Architecture</a> de Martin Fowler</p>
                  <p>
                    Un libro donde se habla del <em>Service Layer Pattern</em>. Que propone una <em>service layer</em> que coordina <em>domain objects</em>
                  </p>
                </small>
              </div>
            </div>
            <aside class="notes">
              <ul>
                <li>Service Layer Pattern (Fowler): A pattern that defines an application's business logic in a set of services that orchestrate domain objects and operations, keeping logic out of controllers and UI.</li>
                <li>Domain Object: An object that models real-world business concepts, containing both data and behavior specific to the domain.</li>
                <li>Services (Fowler): Objects that define business operations without maintaining state, often used to encapsulate domain logic that doesn't naturally fit into entities or value objects.</li>
              </ul>
            </aside>
          </section>
          <section>
            <div style="display: flex;">
              <div style="width: 30%;">
                <img src="images/ddd.jpg" alt="Domain Driven Design">
              </div>
              <div style="width: 70%;">
                <small>
                  <p>
                    En las gu铆as de Rails no se menciona a <a href="https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215">Domain Driven Design</a> pero muchas de sus ideas est谩n presentes.
                  </p>
                <p>
                  Por ejemplo, los conceptos de <em>layered architecture</em> (c贸mo en el patr贸n MVC) y <em>domain objects</em>.
                </p>
                <p>
                    Este es un libro donde se habla de una <em>Application Layer</em> que deber ser fina, no contener l贸gica de negocio (porque la l贸gica de negocio deber铆a estar en los <em>domain objects</em>) y tambi茅n habla del concepto de <em>Services</em>.
                  </p>
                </small>
              </div>
            </div>
            <aside class="notes">
              <ul>
                <li>Layered Architecture: An architectural style that organizes code into layerstypically UI, application, domain, and infrastructureto separate concerns and manage complexity.</li>
                <li>Presentation layer: Responsible for handling user interactions and presenting the information to users (via the UI).</li>
                <li>Application layer: Coordinates tasks and delegates work to the domain layer, without containing business logic itself.</li>
                <li>Domain layer: Describes entities, rules, invariants, and so on. This layer maintains the state of the application.</li>
                <li>Infrastructure layer: Consists of supporting technologies (databases, frameworks, API clients, and so on).</li>
                <li>Services (Evans): Stateless operations that represent domain behavior, used when an action doesn't conceptually belong to any specific object.</li>
                <li>Domain Services: Services that encapsulate domain logic involving multiple entities or operations that don't belong to a single entity.</li>
                <li>Application Services: Orchestrators that coordinate domain objects to execute use cases, without implementing business rules themselves.</li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Yyyy...</h3>
          </section>
          <section>
            <img src="images/mvc_architecture_dark.jpg" alt="MVC Architecture">
            <p>En las <a href="https://guides.rubyonrails.org/getting_started.html#model-view-controller-basics">gu铆as de Rails</a> no se menciona qui茅n se encarga de coordinar a los <em>domain objects</em></p>
          </section>
          <section>
            <h2>Ac谩 la charla se podr铆a bifurcar</h2>
          </section>
          <section>
            <img src="images/meme_paths.png" alt="Meme Paths" class="r-stretch">
          </section>
          <section>
            <h3>No usa Service Objects</h3>
            <blockquote>> We don't distinguish application and domain layers</blockquote>
            <p>
              <a href="https://world.hey.com/jorge/code-i-like-iv-vanilla-rails-is-plenty-71d0465c" target="_blank" rel="noopener">Code I Like - IV - Vanilla Rails is Plenty</a> by Jorge Manrubia (37 signals)
            </p>
          </section>
          <section>
            <h3>No usa Service Objects</h3>
            <p>
              <a href="https://github.com/maybe-finance/maybe" target="_blank" rel="noopener">Maybe</a>: The personal finance app for everyone
            </p>
          </section>
          <section>
            <h3>Usa Service Objects</h3>
            <img src="images/arch-abs-layers.png" alt="Architecture Abstractions Layers">
            <p>
              <a href="https://www.packtpub.com/en-us/product/layered-design-for-ruby-on-rails-applications-9781801813785" target="_blank" rel="noopener">Layered Design for Ruby on Rails Applications</a> by Vladimir Dementyev (Evil Martians)
            </p>
          </section>
        </section>
        <!-- Por qu茅 usar service objects -->
        <section>
          <section>
            <h2>Por qu茅 usar service objects</h2>
          </section>
          <section>
            <h3>Partamos de un ejemplo (casi) real</h3>
            <div class="r-stack">
              <img src="images/subscription_versions.png" alt="Subscription Versions" class="fragment fade-in-then-out">
              <img src="images/subscription_versions_1.png" alt="Subscription Versions 1" class="fragment fade-in-then-out">
              <img src="images/subscription_versions_2.png" alt="Subscription Versions 2" class="fragment fade-in-then-out">
              <img src="images/subscription_versions_3.png" alt="Subscription Versions 3" class="fragment fade-in-then-out">
            </div>
          </section>
          <section>
            <h3>D贸nde va la l贸gica?</h3>
            <div class="r-stack">
              <img src="images/cmm_0.png" class="fragment fade-in-then-out" alt="D贸nde va la l贸gica? 0">
              <img src="images/cmm_1.png" class="fragment fade-in-then-out" alt="D贸nde va la l贸gica? 1">
              <img src="images/cmm_2.png" class="fragment fade-in-then-out" alt="D贸nde va la l贸gica? 2">
              <img src="images/cmm_3.png" class="fragment fade-in-then-out" alt="D贸nde va la l贸gica? 3">
            </div>
          </section>
          <section>
            <h3>El principal beneficio...</h3>
            <!-- fragment this gif https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExOTByZW56bGc2aXlzcGs0dmt6aWc5ZW90c3lhZmQ2MWc5bG9uemdiNSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/rYJBm0wOgkvLTSlXFl/giphy.gif -->
             <!-- the gif is white so the background should be dark -->
            <img src=" https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExOTByZW56bGc2aXlzcGs0dmt6aWc5ZW90c3lhZmQ2MWc5bG9uemdiNSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/rYJBm0wOgkvLTSlXFl/giphy.gif" alt="Feels right" class="r-stretch" style="background-color: black;">
            <aside class="notes">
              Cantidad de commits en los 煤ltimos 5 a帽os:
              <ul>
                <li>subscription: 94</li>
                <li>coupon_remover: 5</li>
              </ul>
            </aside>
          </section>
          <section>
            <h3>Otros beneficios</h3>
            <pre><code class="ruby" data-trim data-noescape data-line-numbers="1-14|10-13|11">
              class Subscription::RemoveCoupon
                include Interactor::Organizer

                before do
                  context.coupon_id = nil
                end

                delegate :subscription, :coupon_id, to: :context

                organize SubscriptionVersion::UpsertPending,
                         SubscriptionVersion::Process,
                         Subscription::UpdateUpcomingInvoice,
                         Customer::NotifyNewSubscriptionVersion
              end
            </code></pre>
            Gema: <a href="https://github.com/collectiveidea/interactor">Interactor</a>
          </section>
        </section>
        <!-- C贸mo aplicarlos -->
        <!-- Completar esta secci贸n -->
        <section>
          <section>
            <h2>C贸mo aplicarlos</h2>
          </section>
          <section>
            <h3>Tenemos que evitar el problema <strong>real</strong></h3>
            <pre><code class="ruby" data-trim data-noescape data-line-numbers="1|2-3|4-5|1-5">
              # C贸mo se llaman?
              # subject + actor (entidad que ejecuta el verbo)
              User::PlanUpdater
              # subject + verb (+ object)
              User::UpdatePlan # -> user.update(plan)
            </code></pre>
            <pre><code class="ruby" data-trim data-noescape data-line-numbers="1|2|4|5|6|7|1-7">
              # Qu茅 devuelven?
              result = User::UpdatePlan

              result.is_a?(User) # ???
              result.is_a?(TrueClass) # ???
              result.is_a?(FalseClass) # ???
              result.is_a?(ResultObject) # ???
            </code></pre>
          </section>
          <section>
            <h3>C贸mo se siente este problema?</h3>
            <div class="r-stack">
              <img src="images/la_plata.png" alt="La Plata" class="fragment fade-in-then-out" style="width: 50%;">
              <img src="images/venecia.png" alt="Venecia" class="fragment fade-in-then-out" style="width: 50%;">
            </div>
          </section>
          <section>
            <h3>The name of the game is convention</h3>
            <div class="r-stack">
              <img src="images/shape_0.png" class="fragment fade-in-then-out" alt="Shape 0">
              <img src="images/shape_1.png" class="fragment fade-in-then-out" alt="Shape 1">
              <img src="images/shape_2.png" class="fragment fade-in-then-out" alt="Shape 2">
              <img src="images/shape_3.png" class="fragment fade-in-then-out" alt="Shape 3">
              <img src="images/shape_4.png" class="fragment fade-in-then-out" alt="Shape 4">
            </div>
          </section>
          <section>
            <h4><a href="https://rails.services/fowler-evans-ruler/">The Fowler Evans Ruler</a> de Ivan Nemytchenko</h4>
            <small>

              <table>
                <tr>
                  <td>Principio</td>
                  <td>Verifica</td>
                </tr>
                <tr>
                  <td>1. Sin estado (Stateless)</td>
                  <td>No tiene variables de instancia ni estado interno</td>
                </tr>
                <tr>
                  <td>2. Nombrado por una actividad</td>
                  <td>Nombre claro orientado a la acci贸n</td>
                </tr>
                <tr>
                  <td>3. Representa una operaci贸n de negocio</td>
                  <td>Expresa un proceso del mundo real</td>
                </tr>
                <tr>
                  <td>4. Coordina objetos del dominio</td>
                  <td>Llama a m茅todos en entidades/value objects</td>
                </tr>
                <tr>
                  <td>5. Controla transacciones</td>
                  <td>Cambia el estado del sistema</td>
                </tr>
                <tr>
                  <td>6. Tiene efectos secundarios</td>
                  <td>Produce un impacto observable</td>
                </tr>
                <tr>
                  <td>7. Sin l贸gica de aplicaci贸n</td>
                  <td>Separaci贸n clara de la interfaz y la infraestructura</td>
                </tr>
              </table>
            </small>
          </section>
          <section>
            <h3>No hace falta reinventar la rueda</h3>
            <small>
              <p>
                Podemos usar alguna de las gemas que ya existen para esto.
              </p>
            </small>
          </section>
          <section>
            <ul>
              <li>
                <a href="https://github.com/collectiveidea/interactor" target="_blank" rel="noopener">Interactor</a>
              </li>
              <li>
                <a href="https://github.com/adomokos/light-service" target="_blank" rel="noopener">Light Service</a>
              </li>
              <li>
                <a href="https://github.com/sunny/actor" target="_blank" rel="noopener">Actor</a>
              </li>
              <li>
                <a href="https://github.com/DmitryTsepelev/clean_actions" target="_blank" rel="noopener">Clean Actions</a>
              </li>
              <li>
                <a href="https://github.com/pabloh/pathway/" target="_blank" rel="noopener">Pathway</a><span></span>
              </li>
            </ul>
          </section>
        </section>
        <!-- Preguntas -->
        <section>
          <section>
            <h2>驴Preguntas?</h2>
          </section>
        </section>
      </div>
    </div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
